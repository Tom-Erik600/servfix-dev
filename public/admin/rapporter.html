<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servicerapporter - Air-Tech Admin</title>
    <link rel="stylesheet" href="/admin/assets/css/admin.css">
    <link rel="stylesheet" href="/admin/assets/css/rapporter.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-layout">
        <header class="app-header">
            <!-- Content loaded dynamically by main.js -->
        </header>

        <main class="main-content">
            <!-- Enhanced page header -->
            <div class="page-header">
                <h1>ğŸ“‹ Servicerapporter</h1>
                <p>Administrer og send servicerapporter til kunder med profesjonell PDF-generering</p>
            </div>

            <!-- Enhanced settings card -->
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-header">
                    <h2>âš™ï¸ Innstillinger</h2>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <label>ğŸ”„ Automatisk sending til kunde</label>
                        <p class="setting-description">Send servicerapport automatisk nÃ¥r tekniker fullfÃ¸rer service. Dette sparer tid og sikrer rask kommunikasjon med kunden.</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="auto-send-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Enhanced filters card -->
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-header">
                    <h2>ğŸ” Filter og sÃ¸k</h2>
                </div>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>ğŸ“Š Status filter</label>
                        <select id="status-filter">
                            <option value="all">ğŸ”„ Alle rapporter</option>
                            <option value="pending">â³ Venter sending</option>
                            <option value="sent">âœ… Sendt til kunde</option>
                            <option value="invoiced">ğŸ’° Fakturerte</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>ğŸ” Fritekst sÃ¸k</label>
                        <input type="text" id="search-input" placeholder="SÃ¸k pÃ¥ kunde, ordre, tekniker eller anlegg...">
                    </div>
                </div>
            </div>

            <!-- Enhanced statistics with modern design -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-value" id="total-reports">0</div>
                    <div class="stat-label">ğŸ“‹ Totalt rapporter</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sent-reports">0</div>
                    <div class="stat-label">âœ‰ï¸ Sendt til kunde</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pending-reports">0</div>
                    <div class="stat-label">â³ Venter pÃ¥ sending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="invoiced-reports">0</div>
                    <div class="stat-label">ğŸ’° Fakturerte</div>
                </div>
            </div>

            <!-- Enhanced reports table -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“Š Servicerapporter oversikt</h2>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <button onclick="reloadReports()" 
                                style="padding: 8px 16px; background: var(--primary-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;"
                                onmouseover="this.style.background='var(--primary-blue-light)'"
                                onmouseout="this.style.background='var(--primary-blue)'">
                            ğŸ”„ Oppdater
                        </button>
                        <span style="font-size: 12px; color: var(--text-light); font-weight: 500;">
                            Sist oppdatert: <span id="last-updated">NÃ¥</span>
                        </span>
                    </div>
                </div>
                <div class="table-container">
                    <table class="reports-table">
                        <thead>
                            <tr>
                                <th>ğŸ“… Servicedato</th>
                                <th>ğŸ“‹ Ordrenummer</th>
                                <th>ğŸ‘¤ Kunde</th>
                                <th>ğŸ”§ Tekniker</th>
                                <th>âš™ï¸ Anlegg</th>
                                <th>ğŸ“Š Status</th>
                                <th>ğŸ¯ Handlinger</th>
                            </tr>
                        </thead>
                        <tbody id="reports-table-body">
                            <tr>
                                <td colspan="7" class="loading-cell">
                                    <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                                        <div style="width: 20px; height: 20px; border: 2px solid #E5E7EB; border-top: 2px solid var(--primary-blue); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                        <span>â³ Laster rapporter...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Enhanced table footer with useful info -->
                <div style="padding: 16px 20px; background: #F8FAFC; border-top: 1px solid #E5E7EB; border-radius: 0 0 12px 12px; display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-secondary);">
                    <div>
                        ğŸ’¡ <strong>Tips:</strong> Bruk Ctrl+R for Ã¥ oppdatere, Ctrl+F for Ã¥ sÃ¸ke
                    </div>
                    <div>
                        ğŸ”„ Automatisk oppdatering hvert 5. minutt
                    </div>
                </div>
            </div>

            <!-- Help section -->
            <div class="card" style="margin-top: 24px; background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%); border: 2px solid var(--primary-blue-light);">
                <div class="card-header">
                    <h2>ğŸ’¡ Hjelpetips</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                    <div>
                        <h3 style="color: var(--primary-blue); margin-bottom: 8px; font-size: 14px;">ğŸ“„ PDF-visning</h3>
                        <p style="font-size: 13px; color: var(--text-secondary); margin: 0;">Klikk "Vis PDF" for Ã¥ Ã¥pne rapporten i en ny fane. PDF-er genereres automatisk nÃ¥r teknikere fullfÃ¸rer oppdrag.</p>
                    </div>
                    <div>
                        <h3 style="color: var(--primary-blue); margin-bottom: 8px; font-size: 14px;">âœ‰ï¸ Sending til kunde</h3>
                        <p style="font-size: 13px; color: var(--text-secondary); margin: 0;">Send rapporter direkte til kundens e-post. Systemet holder oversikt over hvilke rapporter som er sendt.</p>
                    </div>
                    <div>
                        <h3 style="color: var(--primary-blue); margin-bottom: 8px; font-size: 14px;">ğŸ’° Fakturering</h3>
                        <p style="font-size: 13px; color: var(--text-secondary); margin: 0;">Marker rapporter som fakturert for Ã¥ holde oversikt over faktureringsstatus. Legg til kommentarer ved behov.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Enhanced scripts loading -->
    <script src="/admin/assets/js/main.js"></script>
    <script src="/admin/assets/js/rapporter.js"></script>
    
    <!-- Auto-refresh functionality -->
    <script>
        // Auto-refresh every 5 minutes
        setInterval(() => {
            if (typeof reloadReports === 'function') {
                reloadReports();
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString('no-NO');
            }
        }, 5 * 60 * 1000);
        
        // Update last updated time initially
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString('no-NO');
            }, 1000);
        });
    </script>
</body>
</html>